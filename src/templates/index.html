<!DOCTYPE html>
    <html>
    <head>
        <title>Uganda Clinical Guidelines Chatbot</title>
        <style>
            /* ... (previous styles) ... */
            .model-select {
                margin-bottom: 20px;
                padding: 10px;
                background-color: #f8f9fa;
                border-radius: 4px;
            }
            .model-select select {
                padding: 8px;
                border-radius: 4px;
                border: 1px solid #ddd;
            }
            .temperature-control {
                margin-left: 20px;
                display: inline-block;
            }
            .temperature-control input {
                width: 60px;
                padding: 8px;
                border-radius: 4px;
                border: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <h1>Uganda Clinical Guidelines Chatbot</h1>
        <p>Ask questions about the Uganda Clinical Guidelines 2023</p>
        
        <div class="chat-container">
            <div class="model-select">
                <label for="model">Select Model:</label>
                <select id="model">
                    <option value="lmstudio">LM Studio (Local)</option>
                    <option value="openai">OpenAI GPT-4</option>
                </select>
                
                <span class="temperature-control">
                    <label for="temperature">Temperature:</label>
                    <input type="number" id="temperature" value="0.3" min="0" max="1" step="0.1">
                </span>
            </div>
            
            <div class="input-container">
                <input type="text" id="question" placeholder="Enter your medical question...">
                <button onclick="sendQuestion()">Ask</button>
            </div>
            <div id="error"></div>
            <div id="loading" class="loading">Processing your question...</div>
            <div id="response" class="response"></div>
        </div>

        <script>
            async function sendQuestion() {
                const questionInput = document.getElementById('question');
                const modelSelect = document.getElementById('model');
                const temperatureInput = document.getElementById('temperature');
                const responseDiv = document.getElementById('response');
                const errorDiv = document.getElementById('error');
                const loadingDiv = document.getElementById('loading');
                
                const question = questionInput.value.trim();
                const model = modelSelect.value;
                const temperature = parseFloat(temperatureInput.value);
                
                if (!question) {
                    errorDiv.textContent = 'Please enter a question';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                errorDiv.style.display = 'none';
                loadingDiv.style.display = 'block';
                responseDiv.innerHTML = '';
                
                try {
                    const response = await fetch('/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            question: question,
                            model: model,
                            temperature: temperature
                        })
                    });
                    
                    const data = await response.json();
                    loadingDiv.style.display = 'none';
                    
                    if (response.ok) {
                        responseDiv.innerHTML = `
                            <strong>Question:</strong><br>
                            ${question}<br><br>
                            <strong>Answer:</strong><br>
                            ${data.response}<br><br>
                            <em>Model: ${data.metadata.model} (${data.metadata.type})</em>
                        `;
                        questionInput.value = '';
                    } else {
                        errorDiv.textContent = data.detail || 'An error occurred';
                        errorDiv.style.display = 'block';
                    }
                } catch (error) {
                    loadingDiv.style.display = 'none';
                    errorDiv.textContent = 'Failed to get response';
                    errorDiv.style.display = 'block';
                    console.error('Error:', error);
                }
            }
            
            document.getElementById('question').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendQuestion();
                }
            });
        </script>
    </body>
    </html>